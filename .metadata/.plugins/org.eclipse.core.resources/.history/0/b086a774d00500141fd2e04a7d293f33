package kesaprojekti.remotelights;

import java.io.IOException;
import java.util.ArrayList;

import android.app.Activity;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.util.Log;
import android.widget.ArrayAdapter;
import android.widget.ListView;

public class ListActivity extends Activity {
	private static final String XML_FILE	= "settings.xml";

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_list);
		
		ListView lv = (ListView)findViewById(R.id.listView1);
		
		SharedPreferences sharedPrefs		= PreferenceManager.getDefaultSharedPreferences(this);
        int status = sharedPrefs.getInt("status", 0);
		       
		Log.v("list activity", Integer.toString(sharedPrefs.getInt("status", 0))); //testing!
		
		PullParserHandler	parser	= new PullParserHandler();
    	
    	try {
			parser.parse(getAssets().open(XML_FILE), "zonename");
		} catch (IOException e) {
			e.printStackTrace();
		}
    	
    	ArrayList<String> allTargets	= new ArrayList<String>();
    	
    	// get all target names
    	allTargets		= parser.getAllTargets();
    	
    	int targetCount = allTargets.size();
    	int shift		= 1 << targetCount;
    	
    	for (int i = 0; i < targetCount; i++)	{
    		if ((status & shift) == 0)	{
    			allTargets.remove(i);
    		}
    		shift--;
    	}

    	
    	
    	ArrayAdapter<String> adapter = new ArrayAdapter<String>(this, R.layout.list_item, R.id.label, allTargets);
		
		lv.setAdapter(adapter);
    	
	}
}
